<div class="card">
  <div class="col-12">
    <div class="card px-6 py-6">
      <p-toast></p-toast>
      <p-toolbar class="mb-4">
        <ng-template pTemplate="left">
          <div class="my-2">
            <button
              pButton
              pRipple
              label="Ajouter"
              icon="pi pi-plus"
              class="p-button-success mr-2"
              (click)="viderAjouter()"
            ></button>
          </div>
        </ng-template>

        <ng-template pTemplate="right">
          <button
            pButton
            pRipple
            label="Export"
            icon="pi pi-upload"
            class="p-button-help"
            (click)="dt.exportCSV()"
          ></button>
        </ng-template>
      </p-toolbar>

      <p-table
            #dt
            [value]="listVille"
            dataKey="id"
            [rows]="10"
            [rowHover]="true"
            [showGridlines]="true"
            [paginator]="true"
            [globalFilterFields]="['nomVille']"
            [rowsPerPageOptions]="[10, 20, 30]"
            [showCurrentPageReport]="true"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
            [rowHover]="true"
            responsiveLayout="scroll"
        >
        <ng-template #caption>
            <div class="flex justify-between items-center flex-column sm:flex-row">
                <button pButton label="Clear" class="p-button-outlined mb-2" icon="pi pi-filter-slash" (click)="clear(dt)"></button>
                <p-iconfield iconPosition="left" class="ml-auto">
                    <p-inputicon>
                        <i class="pi pi-search"></i>
                    </p-inputicon>
                    <input pInputText type="text" (input)="onGlobalFilter(dt, $event)" placeholder="Search keyword" />
                </p-iconfield>
            </div>
        </ng-template>

        <ng-template #header>
          <tr>
            <th></th>
            <th style="min-width: 12rem">
                <div class="flex justify-between items-center">
                    Ville
                    <p-columnFilter type="text" field="nomVille" display="menu" placeholder="Search by ville"></p-columnFilter>
                </div>
            </th>
          </tr>
        </ng-template>
        <ng-template #body let-p>
          <tr>
            <td style="width: 14%; min-width: 10rem">
              <div class="flex gap-2">
                <p-button (click)="recupperer(1, p)" icon="pi pi-pencil" severity="success" rounded />
                <p-button (click)="recupperer(2, p)" icon="pi pi-trash" severity="danger" rounded />
              </div>
            </td>
            <td>
              {{ p.nomVille }}
            </td>
          </tr>
        </ng-template>

        <ng-template #emptymessage>
            <tr>
                <td colspan="3">No Villes found.</td>
            </tr>
        </ng-template>
        <ng-template #loadingbody>
            <tr>
                <td colspan="3">Loading Villes data. Please wait.</td>
            </tr>
        </ng-template>
      </p-table>
    </div>

    <p-dialog
      [(visible)]="dialogAjouter"
      [style]="{ width: '700px' }"
      header="Mise Ã  jour Ville"
      [modal]="true"
      class="p-fluid"
      [closable]="false"
    >
      <!-- Form content must go inside ng-template -->
      <ng-template pTemplate="content">
        <div [formGroup]="formGroup" class="flex flex-col gap-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="field col">
                <label for="nomVille" class="font-semibold">Ville</label>
                <div class="input-button-group">
                  <input 
                    pInputText
                    id="nomVille"
                    formControlName="nomVille"
                    required
                    [ngClass]="{
                      'ng-invalid ng-dirty':
                        submitted && formGroup.get('nomVille')?.invalid
                    }"
                  />
                </div>
                @if (submitted && formGroup.get('nomVille')?.invalid) {
                  <small class="ng-dirty ng-invalid p-error">
                    Ville obligatoire.
                  </small>
                }
            </div>
          </div>
        </div>
      </ng-template>

      <!-- Footer template -->
      <ng-template pTemplate="footer">
        <button
          pButton
          pRipple
          label="Fermer"
          icon="pi pi-times"
          class="p-button-outlined p-button-info"
          (click)="openCloseDialogAjouter(false)"
        ></button>
        <button
          pButton
          pRipple
          label="Valider"
          icon="pi pi-check"
          class="p-button-info"
          (click)="miseAjour()"
          [disabled]="!formGroup.valid"
        ></button>
      </ng-template>
    </p-dialog>

    <p-dialog
      [(visible)]="dialogSupprimer"
      header="Confirm"
      [modal]="true"
      [style]="{ width: '450px' }"
      [closable]="false"
    >
      <div class="flex align-items-center justify-content-center">
        <i class="pi pi-exclamation-triangle mr-3" style="font-size: 2rem"></i>
        @if (ville) {
          <span>Are you sure you want to delete this ville ?</span>
        }
      </div>
      <ng-template pTemplate="footer">
        <button
          pButton
          pRipple
          icon="pi pi-times"
          type="button"
          label="Fermer"
          class="p-button-outlined p-button-info"
          (click)="dialogSupprimer = false"
        ></button>
        <button
          pButton
          pRipple
          label="Valider"
          icon="pi pi-check"
          class="p-button-info"
          (click)="supprimer()"
        ></button>
      </ng-template>
    </p-dialog>
  </div>
</div>
